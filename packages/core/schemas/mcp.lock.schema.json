{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mcpshield.dev/schemas/v1/mcp.lock.schema.json",
  "title": "MCPShield Lockfile",
  "description": "Lockfile for MCPShield (mcp.lock.json)",
  "type": "object",
  "additionalProperties": false,
  "required": ["version", "generatedAt", "servers"],
  "properties": {
    "version": {
      "type": "string",
      "const": "1.0.0",
      "description": "Lockfile schema version"
    },
    "generatedAt": {
      "type": "string",
      "format": "date-time",
      "description": "ISO timestamp when the lockfile was generated"
    },
    "servers": {
      "type": "object",
      "description": "Map of server namespace to lockfile entry",
      "additionalProperties": { "$ref": "#/definitions/LockfileEntry" }
    }
  },
  "definitions": {
    "LockfileEntry": {
      "type": "object",
      "additionalProperties": false,
      "required": ["namespace", "version", "verified", "fetchedAt", "artifacts"],
      "properties": {
        "namespace": {
          "type": "string",
          "description": "Server namespace (reverse-DNS)"
        },
        "version": {
          "type": "string",
          "description": "Server version"
        },
        "resolved": {
          "type": ["string", "null"],
          "description": "Resolved source URL (e.g., repository URL)"
        },
        "repository": {
          "type": ["string", "null"],
          "description": "Repository URL"
        },
        "verified": {
          "type": "boolean",
          "description": "Whether publisher identity is verified"
        },
        "verificationMethod": {
          "type": ["string", "null"],
          "description": "Verification method used (e.g., github)"
        },
        "verifiedOwner": {
          "type": ["string", "null"],
          "description": "Verified owner (e.g., GitHub org/user)"
        },
        "fetchedAt": {
          "type": "string",
          "format": "date-time",
          "description": "When server metadata was fetched"
        },
        "approvedAt": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "When a policy override approval was recorded (if any)"
        },
        "approvedBy": {
          "type": ["string", "null"],
          "description": "Who approved a policy override (if any)"
        },
        "artifacts": {
          "type": "array",
          "description": "Artifacts pinned for this server",
          "items": { "$ref": "#/definitions/Artifact" }
        }
      }
    },
    "Artifact": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "url", "digest"],
      "properties": {
        "type": {
          "type": "string",
          "description": "Artifact type (npm/pypi/docker/etc)"
        },
        "url": {
          "type": "string",
          "description": "Resolved artifact URL"
        },
        "digest": {
          "type": "string",
          "pattern": "^(sha256|sha512)-[A-Za-z0-9+/=]+$",
          "description": "Content digest (algorithm-base64)"
        },
        "size": {
          "type": "integer",
          "minimum": 0,
          "description": "Artifact size in bytes (if known)"
        }
      }
    }
  }
}
