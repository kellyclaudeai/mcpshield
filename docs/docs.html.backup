<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - MCPShield</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0066ff;
            --text: #1a1a1a;
            --text-light: #666;
            --bg: #ffffff;
            --bg-light: #f8f9fa;
            --border: #e1e4e8;
            --code-bg: #f6f8fa;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: var(--bg-light);
        }

        header {
            background: white;
            border-bottom: 1px solid var(--border);
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            text-decoration: none;
        }

        .layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            max-width: 1400px;
            margin: 0 auto;
            gap: 40px;
            padding: 40px 20px;
        }

        .sidebar {
            position: sticky;
            top: 100px;
            height: fit-content;
        }

        .sidebar h3 {
            font-size: 14px;
            text-transform: uppercase;
            color: var(--text-light);
            margin-bottom: 15px;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            margin-bottom: 8px;
        }

        .sidebar a {
            color: var(--text);
            text-decoration: none;
            display: block;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .sidebar a:hover {
            background: var(--code-bg);
            color: var(--primary);
        }

        .doc-content {
            background: white;
            padding: 50px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        h1 {
            font-size: 42px;
            margin-bottom: 20px;
        }

        h2 {
            font-size: 32px;
            margin: 50px 0 20px;
            padding-top: 30px;
            border-top: 2px solid var(--border);
            scroll-margin-top: 100px;
        }

        h2:first-of-type {
            border-top: none;
            margin-top: 30px;
        }

        h3 {
            font-size: 24px;
            margin: 30px 0 15px;
            color: var(--primary);
            scroll-margin-top: 100px;
        }

        h4 {
            font-size: 18px;
            margin: 20px 0 10px;
            font-weight: 600;
        }

        p {
            margin-bottom: 15px;
            line-height: 1.7;
        }

        code {
            background: var(--code-bg);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
        }

        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            line-height: 1.5;
        }

        pre code {
            background: none;
            padding: 0;
            color: inherit;
        }

        ul, ol {
            margin: 15px 0 15px 30px;
        }

        li {
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg-light);
            font-weight: 600;
        }

        .btn-back {
            display: inline-block;
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            text-decoration: none;
            border-radius: 6px;
        }

        .note {
            background: #e6f2ff;
            border-left: 4px solid var(--primary);
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        @media (max-width: 1024px) {
            .layout {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: static;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <a href="index.html" class="logo">üõ°Ô∏è MCPShield</a>
            <a href="index.html" class="btn-back">‚Üê Back to Home</a>
        </div>
    </header>

    <div class="layout">
        <aside class="sidebar">
            <h3>Documentation</h3>
            <ul>
                <li><a href="#cli-reference">CLI Reference</a></li>
                <li><a href="#lockfile-spec">Lockfile Spec</a></li>
                <li><a href="#policy-config">Policy Config</a></li>
                <li><a href="#security-scanning">Security Scanning</a></li>
                <li><a href="#integration">Integration</a></li>
                <li><a href="#api">API Documentation</a></li>
                <li><a href="#architecture">Architecture</a></li>
            </ul>
        </aside>

        <main class="doc-content">
            <h1>üìö Documentation</h1>
            <p>Complete reference for MCPShield</p>

            <h2 id="cli-reference">CLI Reference</h2>

            <h3 id="init">mcp-shield init</h3>
            <p>Initialize MCPShield in your project.</p>
            <pre><code>mcp-shield init [options]</code></pre>

            <h4>Options</h4>
            <table>
                <tr>
                    <th>Flag</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>--force</code></td>
                    <td>Overwrite existing files</td>
                </tr>
            </table>

            <h4>Creates</h4>
            <ul>
                <li><code>mcp.lock.json</code> - Empty lockfile</li>
                <li><code>policy.yaml</code> - Default policy configuration</li>
            </ul>

            <h3 id="add">mcp-shield add</h3>
            <p>Add an MCP server with verification and security scanning.</p>
            <pre><code>mcp-shield add &lt;server-name&gt; [options]</code></pre>

            <h4>Arguments</h4>
            <ul>
                <li><code>server-name</code> - Namespace of the server (e.g., <code>io.github.user/repo</code>)</li>
            </ul>

            <h4>Options</h4>
            <table>
                <tr>
                    <th>Flag</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>-y, --yes</code></td>
                    <td>Skip confirmation prompts</td>
                </tr>
                <tr>
                    <td><code>--skip-scan</code></td>
                    <td>Skip security scan (not recommended)</td>
                </tr>
                <tr>
                    <td><code>--version &lt;ver&gt;</code></td>
                    <td>Specify exact version to add</td>
                </tr>
            </table>

            <h4>Workflow</h4>
            <ol>
                <li>Fetch metadata from MCP Registry</li>
                <li>Verify namespace ownership (GitHub)</li>
                <li>Download artifacts (npm/PyPI packages)</li>
                <li>Compute SHA-512 digests</li>
                <li>Run security scan</li>
                <li>Display results and prompt for approval</li>
                <li>Add to <code>mcp.lock.json</code></li>
            </ol>

            <h3 id="verify">mcp-shield verify</h3>
            <p>Re-verify all servers in the lockfile.</p>
            <pre><code>mcp-shield verify [options]</code></pre>

            <h4>Options</h4>
            <table>
                <tr>
                    <th>Flag</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>--server &lt;name&gt;</code></td>
                    <td>Verify specific server only</td>
                </tr>
                <tr>
                    <td><code>--strict</code></td>
                    <td>Exit with error on any drift</td>
                </tr>
            </table>

            <h4>Checks</h4>
            <ul>
                <li>Download artifacts from cache or registry</li>
                <li>Recompute digests</li>
                <li>Compare against lockfile</li>
                <li>Report drift if detected</li>
            </ul>

            <h3 id="scan">mcp-shield scan</h3>
            <p>Run comprehensive security scan on all servers.</p>
            <pre><code>mcp-shield scan [options]</code></pre>

            <h4>Options</h4>
            <table>
                <tr>
                    <th>Flag</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>--server &lt;name&gt;</code></td>
                    <td>Scan specific server only</td>
                </tr>
                <tr>
                    <td><code>--json</code></td>
                    <td>Output results as JSON</td>
                </tr>
                <tr>
                    <td><code>--verbose</code></td>
                    <td>Show detailed findings</td>
                </tr>
            </table>

            <h4>Security Checks</h4>
            <ul>
                <li><strong>Typosquatting</strong> - Levenshtein distance against popular packages</li>
                <li><strong>Code Patterns</strong> - Detect eval(), exec(), child_process</li>
                <li><strong>Network Calls</strong> - Identify suspicious remote connections</li>
                <li><strong>Install Scripts</strong> - Flag dangerous lifecycle hooks</li>
                <li><strong>Dependencies</strong> - Scan transitive dependencies</li>
            </ul>

            <h2 id="lockfile-spec">Lockfile Specification</h2>

            <p>The <code>mcp.lock.json</code> file uses this schema:</p>

            <pre><code>{
  "version": "1.0.0",
  "generatedAt": "2026-02-05T15:30:00.000Z",
  "servers": {
    "&lt;namespace&gt;": {
      "namespace": "string",
      "version": "string",
      "verified": boolean,
      "verificationMethod": "github" | "npm" | "pypi" | null,
      "verifiedOwner": "string" | null,
      "fetchedAt": "ISO8601 timestamp",
      "artifacts": [
        {
          "type": "npm" | "pypi" | "docker",
          "url": "string",
          "digest": "sha512-...",
          "size": number
        }
      ]
    }
  }
}</code></pre>

            <h3>Fields</h3>

            <table>
                <tr>
                    <th>Field</th>
                    <th>Type</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>namespace</code></td>
                    <td>string</td>
                    <td>Unique identifier (e.g., io.github.user/repo)</td>
                </tr>
                <tr>
                    <td><code>version</code></td>
                    <td>string</td>
                    <td>Semantic version</td>
                </tr>
                <tr>
                    <td><code>verified</code></td>
                    <td>boolean</td>
                    <td>Whether namespace ownership was verified</td>
                </tr>
                <tr>
                    <td><code>verificationMethod</code></td>
                    <td>string</td>
                    <td>How namespace was verified (github, npm, pypi)</td>
                </tr>
                <tr>
                    <td><code>artifacts</code></td>
                    <td>array</td>
                    <td>Downloadable artifacts with digests</td>
                </tr>
            </table>

            <h2 id="policy-config">Policy Configuration</h2>

            <p>The <code>policy.yaml</code> file defines security policies:</p>

            <pre><code>version: 1.0.0

policies:
  # Maximum acceptable risk score (0-100)
  maxRiskScore: 50

  # Require namespace verification
  requireVerification: true

  # Block packages with these code patterns
  blockPatterns:
    - eval
    - exec
    - child_process
    - crypto.createCipheriv

  # Allowed package registries
  allowedRegistries:
    - registry.npmjs.org
    - pypi.org

  # Trusted publishers (auto-approve)
  trustedPublishers:
    - modelcontextprotocol

  # Forbidden dependencies
  blockedDependencies:
    - malicious-package
    - known-exploit

  # Minimum version requirements
  minVersions:
    npm: "9.0.0"
    node: "18.0.0"</code></pre>

            <div class="note">
                <strong>Note:</strong> Policy enforcement is planned for future releases. Currently policies are advisory only.
            </div>

            <h2 id="security-scanning">Security Scanning</h2>

            <h3>Risk Scoring</h3>

            <p>Each server receives a risk score from 0-100:</p>

            <table>
                <tr>
                    <th>Score</th>
                    <th>Verdict</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>0-30</td>
                    <td>‚úÖ CLEAN</td>
                    <td>Safe to use</td>
                </tr>
                <tr>
                    <td>31-60</td>
                    <td>‚ö†Ô∏è WARNING</td>
                    <td>Review findings before use</td>
                </tr>
                <tr>
                    <td>61-80</td>
                    <td>üö® SUSPICIOUS</td>
                    <td>High risk, not recommended</td>
                </tr>
                <tr>
                    <td>81-100</td>
                    <td>üö® MALICIOUS</td>
                    <td>Do not use</td>
                </tr>
            </table>

            <h3>Detection Rules</h3>

            <h4>Typosquatting (+30 points)</h4>
            <ul>
                <li>Levenshtein distance &lt; 3 from popular package</li>
                <li>Common character swaps (1 vs l, 0 vs O)</li>
                <li>Name similarity to official packages</li>
            </ul>

            <h4>Suspicious Code (+20 points each)</h4>
            <ul>
                <li><code>eval()</code> - Dynamic code execution</li>
                <li><code>exec()</code> - Shell command execution</li>
                <li><code>child_process</code> - Process spawning</li>
                <li>Obfuscated code (hex strings, base64)</li>
            </ul>

            <h4>Network Calls (+15 points)</h4>
            <ul>
                <li>HTTP/HTTPS requests to unknown domains</li>
                <li>WebSocket connections</li>
                <li>DNS lookups to suspicious TLDs (.ru, .cn)</li>
            </ul>

            <h4>Install Scripts (+10 points)</h4>
            <ul>
                <li>postinstall, preinstall scripts</li>
                <li>File system modifications</li>
                <li>Download/execute behavior</li>
            </ul>

            <h2 id="integration">Integration Examples</h2>

            <h3>GitHub Actions</h3>

            <pre><code>name: Security Check
on: [push, pull_request]

jobs:
  mcp-shield:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install MCPShield
        run: npm install -g @kellyclaude/mcpshield
      
      - name: Verify MCP servers
        run: |
          mcp-shield verify --strict
          mcp-shield scan
</code></pre>

            <h3>Pre-commit Hook</h3>

            <pre><code>#!/bin/sh
# .git/hooks/pre-commit

echo "Running MCPShield verification..."
mcp-shield verify

if [ $? -ne 0 ]; then
  echo "‚ùå MCP server verification failed!"
  exit 1
fi

echo "‚úÖ All MCP servers verified"
exit 0</code></pre>

            <h3>CI/CD Integration</h3>

            <pre><code>// package.json
{
  "scripts": {
    "pretest": "mcp-shield verify",
    "security": "mcp-shield scan --json > security-report.json"
  }
}</code></pre>

            <h2 id="api">API Documentation</h2>

            <h3>Programmatic Usage</h3>

            <p>Use MCPShield as a library in your Node.js applications:</p>

            <pre><code>import { RegistryClient, Scanner, Lockfile } from '@kellyclaude/mcpshield-core';

// Fetch server metadata
const client = new RegistryClient();
const server = await client.getServerMetadata('io.github.user/repo');

// Run security scan
const scanner = new Scanner();
const result = await scanner.scanServer(server);

console.log(`Risk Score: ${result.riskScore}`);
console.log(`Verdict: ${result.verdict}`);

// Update lockfile
const lockfile = await Lockfile.load('mcp.lock.json');
await lockfile.addServer(server);
await lockfile.save();</code></pre>

            <h3>Core Classes</h3>

            <h4>RegistryClient</h4>
            <pre><code>class RegistryClient {
  async getServerMetadata(namespace: string): Promise&lt;ServerMetadata&gt;
  async fetchArtifacts(server: ServerMetadata): Promise&lt;Artifact[]&gt;
}</code></pre>

            <h4>Scanner</h4>
            <pre><code>class Scanner {
  async scanServer(server: ServerMetadata): Promise&lt;ScanResult&gt;
  async scanPackage(packagePath: string): Promise&lt;ScanResult&gt;
}</code></pre>

            <h4>Lockfile</h4>
            <pre><code>class Lockfile {
  static async load(path: string): Promise&lt;Lockfile&gt;
  async addServer(server: LockedServer): Promise&lt;void&gt;
  async removeServer(namespace: string): Promise&lt;void&gt;
  async save(): Promise&lt;void&gt;
}</code></pre>

            <h2 id="architecture">Architecture</h2>

            <h3>Monorepo Structure</h3>

            <pre><code>mcpshield/
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ core/           # Core types and clients
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ registry-client.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ namespace-verifier.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lockfile.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ artifact-resolver.ts
‚îÇ   ‚îú‚îÄ‚îÄ scanner/        # Security scanning
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scanner.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rules/
‚îÇ   ‚îî‚îÄ‚îÄ cli/            # Command-line interface
‚îÇ       ‚îú‚îÄ‚îÄ cli.ts
‚îÇ       ‚îî‚îÄ‚îÄ commands/
‚îú‚îÄ‚îÄ test/
‚îÇ   ‚îú‚îÄ‚îÄ unit/
‚îÇ   ‚îî‚îÄ‚îÄ e2e/
‚îî‚îÄ‚îÄ docs/</code></pre>

            <h3>Data Flow</h3>

            <ol>
                <li><strong>Registry Fetch</strong> - RegistryClient fetches server metadata from MCP Registry</li>
                <li><strong>Namespace Verification</strong> - NamespaceVerifier validates GitHub ownership via API</li>
                <li><strong>Artifact Download</strong> - ArtifactResolver downloads npm/PyPI packages</li>
                <li><strong>Digest Computation</strong> - SHA-512 hashes computed for all artifacts</li>
                <li><strong>Security Scan</strong> - Scanner analyzes code for threats</li>
                <li><strong>Lockfile Update</strong> - Verified server added to mcp.lock.json</li>
            </ol>

            <h3>Verification Methods</h3>

            <table>
                <tr>
                    <th>Method</th>
                    <th>Namespace Format</th>
                    <th>Verification</th>
                </tr>
                <tr>
                    <td>GitHub</td>
                    <td>io.github.owner/repo</td>
                    <td>GitHub API + repo ownership</td>
                </tr>
                <tr>
                    <td>npm</td>
                    <td>npm.package-name</td>
                    <td>npm registry + maintainer list</td>
                </tr>
                <tr>
                    <td>PyPI</td>
                    <td>pypi.package-name</td>
                    <td>PyPI API + owner verification</td>
                </tr>
            </table>

            <h3>Technology Stack</h3>

            <ul>
                <li><strong>TypeScript</strong> - Type-safe development</li>
                <li><strong>Node.js</strong> - Runtime (‚â•18.0.0)</li>
                <li><strong>npm Workspaces</strong> - Monorepo management</li>
                <li><strong>Commander.js</strong> - CLI framework</li>
                <li><strong>Axios</strong> - HTTP client</li>
                <li><strong>yaml</strong> - Policy parsing</li>
            </ul>

        </main>
    </div>
</body>
</html>
